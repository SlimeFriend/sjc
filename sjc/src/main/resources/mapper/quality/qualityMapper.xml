<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sjc.app.quality.mapper.QualityMapper">
	<select id="selectQualityWaitInfo" resultType="MtlOdVO">
		SELECT mtl_od_code
               , mtl_od_quantity
               , mtl_od_date
               , dilivery_date
               , price
               , mt_code
               , cp_code
               , user_id
               , mtl_od_status

		FROM mtl_od
		WHERE mtl_od_status = '품질검사대기'

	</select>
	<select id="selectQualityDoneInfo" resultType="InspectionVO">
		SELECT i.ins_date
               , i.ins_code
               , i.ins_status
               , o.cp_code
               , m.mt_name
               , m.specification
               , i.number_of_tests
               , i.number_of_passes
               , i.total_pass
               , o.mtl_od_code
		FROM copy_mtl_od o
		    JOIN inspection i
		        ON o.mtl_od_code = i.mtl_od_code
		    JOIN copy_mt m
		        ON o.mt_code = m.mt_code
		WHERE i.ins_status = '검사 완료'
	</select>
<!-- 	<select id="selectQualityRegistrationInfo" resultType="InspectionVO">
		SELECT i.ins_code ins_code
		       , i.ins_status
		       , i.ins_date
		       , i.ins_sort
		       , i.ins_target
		       , i.ins_type_code
		       , i.user_id
		       , i.user_name
		       , o.mtl_od_code
		       , o.mtl_od_quantity
		       , o.mtl_od_date
		       , o.dilivery_date
		       , o.price
		       , o.mt_code
		       , o.cp_code
		       , m.mt_name
		FROM mtl_od o
		    JOIN inspection i
		        ON o.mtl_od_code = i.mtl_od_code
		    JOIN mt m
		        ON o.mt_code = m.mt_code
		 WHERE
		 	o.mtl_od_code = #{mtlOdCode}
	</select> -->
	
	<select id="selectQualityRegistrationInfo" resultType="InspectionVO">
		SELECT i.ins_code ins_code
		       , i.ins_status
		       , i.ins_type_code
		       , o.mtl_od_code
		       , o.mtl_od_quantity
		       , o.mtl_od_date
		       , o.dilivery_date
		       , o.price
		       , o.mt_code
		       , o.cp_code
		       , m.mt_name
		FROM copy_mtl_od o
		    JOIN inspection i
		        ON o.mtl_od_code = i.mtl_od_code
		    JOIN mt m
		        ON o.mt_code = m.mt_code
		 WHERE
		 	o.mtl_od_code = #{mtlOdCode}
	</select>
	
	<select id="selectQualityTestInfo" resultType="InsItemVO">
		SELECT  i.ins_item_name ins_item_name
        		,i.ins_item_citeria ins_item_citeria
		FROM    ins_type t
		JOIN    ins_item i
			ON      t.ins_type_code = i.ins_type_code
		WHERE   t.MATERIAL_TYPE = (
    								SELECT MATERIAL_TYPE
    								FROM    mt
   									WHERE   mt_code = (
												        SELECT  mt_code
												        FROM    mtl_od
												        WHERE   mtl_od_code = #{mtlOdCode}
									    				)
									)
	</select>

	<!-- 입고검사완료페이지(임의로 만든거) - 값 입고처리 버튼 누르면 수정 -->
	<update id="updateIncoming" parameterType="map">
		UPDATE inspection i, mt m
		SET i.ins_status = #{insStatus},
		o.cp_code = #{cpCode},
		m.mt_name = #{mtName},
		m.specification = #{specification},
		i.number_of_tests = #{numberOfTests},
		i.number_of_passes = #{numberOfPasses},
		i.total_pass = #{totalPass}
		FROM mtl_od o
		JOIN inspection i
		ON o.mtl_od_code = i.mtl_od_code
		JOIN mt m
		ON o.mt_code = m.mt_code
		WHERE i.ins_code = #{insCode}
	</update>



<!--  입고검사완료페이지 - 값 입고처리 버튼 누르면 자재발주상태(mtl_od/ status), ins(품질검사 상태) 완료로 넘기기 -->
	<update id="updateInspectionDone" parameterType="InspectionVO">
		UPDATE inspection
		SET ins_status = '검사 완료'
		WHERE mtl_od_code = #{mtlOdCode}
	</update>

	<update id="updateMtlOdDone" parameterType="InspectionVO">
		UPDATE copy_mtl_od
		SET mtl_od_status = '품질검사 완료'
		WHERE mtl_od_code = #{mtlOdCode}
	</update>


</mapper>