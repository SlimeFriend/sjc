<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net/thymeleaf/layout"
      layout:decorate="~{common/layouts/default_layout}"
      layout:fragment="Content">
<body>
    <div class="main-container mt-5">
        <h1>전체 재고 관리</h1>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>자재 코드</th>
                    <th>자재명</th>
                    <th>자재 구분</th>
                    <th>수량</th>
                    <th>상세보기</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="material : ${materials}">
                    <td th:text="${material.mtCode}"></td>
                    <td th:text="${material.mtName}"></td>
                    <td th:text="${material.materialType}"></td>
                    <td th:text="${material.lotDetails != null && material.lotDetails.size() > 0 ? #lists.sum(material.lotDetails, 'inquantity') : '-'}"></td>
                    <td>
                        <a th:href="@{/stock/{mtCode}/lots(mtCode=${material.mtCode})}" class="btn btn-info">상세보기</a>
                    </td>
                </tr>
            </tbody>
        </table>

        <div id="lotDetailsContainer">
            <h3>상세 조회 결과</h3>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Lot 번호</th>
                        <th>자재명</th>
                        <th>수량</th>
                        <th>입고 날짜</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="lotDetail : ${lotDetails}">
                        <td th:text="${lotDetail.lotNo != null ? lotDetail.lotNo : '-'}"></td>
                        <td th:text="${lotDetail.mtName != null ? lotDetail.mtName : '-'}"></td>
                        <td th:text="${lotDetail.inquantity != null ? lotDetail.inquantity : '-'}"></td>
                        <td th:text="${lotDetail.inputDate != null ? #dates.format(lotDetail.inputDate, 'yyyy-MM-dd') : '-'}"></td>
                    </tr>
                </tbody>
            </table>

            <div th:if="${lotDetails == null or #lists.isEmpty(lotDetails)}">
                <p>입고된 자재가 없습니다.</p>
            </div>
        </div>
    </div>
</body>
</html>
